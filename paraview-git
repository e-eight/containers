Bootstrap: docker
From: debian:bookworm-slim

%post
  apt update -y
  apt install -y git cmake build-essential libgl1-mesa-dev libxt-dev \
      libqt5x11extras5-dev libqt5help5 qttools5-dev qtxmlpatterns5-dev-tools \
      libqt5svg5-dev python3-dev python3-numpy libopenmpi-dev libtbb-dev \
      ninja-build qtbase5-dev qtchooser qt5-qmake qtbase5-dev-tools

  export PATH=$PATH:/usr/lib64/openmpi/bin/

  cd /opt
  git clone --recursive https://gitlab.kitware.com/paraview/paraview.git
  cd paraview
  git checkout v5.11.0
  git submodule update --init --recursive
  cd ..
  cmake -GNinja -DPARAVIEW_USE_PYTHON=ON -DPARAVIEW_USE_MPI=ON -DVTK_SMP_IMPLEMENTATION_TYPE=TBB -DCMAKE_BUILD_TYPE=Release ./paraview
  ninja -j 32

  rm -rf paraview
  apt-get clean && rm -rf /var/bin/apt/lists/*
  
%environment
  export PATH=/opt/bin:$PATH

%runscript
  /opt/bin/paraview